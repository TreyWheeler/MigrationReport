# MigrationReport Data Dictionary

The MigrationReport dataset now mirrors a relational model so the static site can be reasoned about like a database. The JSON files inside `data/` each act as a logical table that can be joined by their identifier fields.

## Table Overview

| File | Purpose | Primary Fields |
| --- | --- | --- |
| `data/categories.json` | Canonical list of evaluation categories. | `id`, `name`, `order` |
| `data/category_keys.json` | Individual evaluation keys that belong to categories. | `id`, `categoryId`, `name`, `guidance` |
| `data/countries.json` | Top-level locations that have full migration reports. | `id`, `name`, `report` |
| `data/cities.json` | City-level reports linked back to their country. | `id`, `countryId`, `name`, `report` |
| `data/people.json` | Persona definitions used for weightings in comparisons. | `id`, `name` |
| `data/person_weights.json` | Weight assignments that join people to categories. | `personId`, `categoryId`, `weight` |

## Relationships

- **Categories → Keys**: Join `categories.id` to `category_keys.categoryId` to determine which keys roll up into each category.
- **Countries → Cities**: Join `countries.id` to `cities.countryId` to list every city nested under a country.
- **People → Weights**: Join `people.id` to `person_weights.personId` to see how each persona scores the categories. Link `person_weights.categoryId` back to `categories.id` to recover the category name.

## Field Notes

### `data/categories.json`
- `id`: Stable slug used as the foreign key target for other tables.
- `name`: Human-readable label displayed in the UI.
- `order`: Optional numeric sort index. Lower numbers render first; ties fall back to alphabetical ordering.

### `data/category_keys.json`
- `id`: Stable slug for the key (used to track edits over time).
- `categoryId`: References `categories.id`.
- `name`: Display label surfaced to users.
- `guidance`: Author guidance for maintaining consistent scoring narratives.

### `data/countries.json`
- `id`: Stable slug that other data (like cities) reference.
- `name`: Display label for the country.
- `report`: Path to the country’s report JSON inside `reports/`.

### `data/cities.json`
- `id`: Stable slug for the city.
- `countryId`: References `countries.id` to tie the city to its parent nation.
- `name`: Display name in the picker.
- `report`: Path to the city’s report JSON inside `reports/`.

### `data/people.json`
- `id`: Stable slug for the persona.
- `name`: Human-readable persona label.

### `data/person_weights.json`
- `personId`: References `people.id`.
- `categoryId`: References `categories.id`.
- `weight`: Numeric weight used when computing persona-aligned scores.

## Derived Structures

The front-end combines these tables at runtime (see `script.js`) to rehydrate the legacy structures:
- `Categories`: Generated by joining categories to keys.
- `Countries`: Generated by joining countries to cities.
- `People`: Generated by pivoting `person_weights` onto each persona.

When adding or updating data, edit the relevant table(s) and the application will reflect the changes without additional build steps.

## PowerShell Maintenance Scripts

The `scripts/powershell` directory contains helper-driven scripts for batch editing the JSON tables without manual file edits. Each mutation script accepts an array argument so multiple records can be processed in a single invocation. Dot-source the helper file when invoking from another script, or call the scripts directly from PowerShell:

```powershell
pwsh scripts/powershell/Categories_INSERT.ps1 -Records @(
    @{ id = 'new_category'; name = 'New Category'; order = 15 },
    @{ id = 'second_category'; name = 'Second Category' }
)
```

The complementary GET scripts make it easy to review current data before applying changes. They default to emitting PowerShell objects and support filtering by key fields; pass the `-AsJson` switch to produce JSON output when scripting against other tools:

```powershell
pwsh scripts/powershell/Cities_GET.ps1 -CountryIds 'mexico' -AsJson
```

### Script Inventory

| Table | Get | Insert | Update | Delete | Notes |
| --- | --- | --- | --- | --- | --- |
| Categories | `Categories_GET.ps1` (optional `-Ids`) | `Categories_INSERT.ps1` | `Categories_UPDATE.ps1` | `Categories_DELETE.ps1` | Delete accepts IDs as strings or objects containing `id`. |
| Category Keys | `CategoryKeys_GET.ps1` (optional `-Ids`, `-CategoryIds`) | `CategoryKeys_INSERT.ps1` | `CategoryKeys_UPDATE.ps1` | `CategoryKeys_DELETE.ps1` | Insert requires `id`, `categoryId`, `name`; `guidance` is optional. |
| Countries | `Countries_GET.ps1` (optional `-Ids`) | `Countries_INSERT.ps1` | `Countries_UPDATE.ps1` | `Countries_DELETE.ps1` | Insert requires `report` path in addition to `id`/`name`. |
| Cities | `Cities_GET.ps1` (optional `-Ids`, `-CountryIds`) | `Cities_INSERT.ps1` | `Cities_UPDATE.ps1` | `Cities_DELETE.ps1` | Insert requires `countryId`, `name`, and `report`. |
| People | `People_GET.ps1` (optional `-Ids`) | `People_INSERT.ps1` | `People_UPDATE.ps1` | `People_DELETE.ps1` | Delete accepts IDs as strings or objects containing `id`. |
| Person Weights | `PersonWeights_GET.ps1` (optional `-PersonIds`, `-CategoryIds`) | `PersonWeights_INSERT.ps1` | `PersonWeights_UPDATE.ps1` | `PersonWeights_DELETE.ps1` | Operations require both `personId` and `categoryId` to target composite keys. |

All scripts rely on `JsonTableHelpers.ps1` for consistent file handling, validation, and persistence. The helper automatically resolves paths relative to the repository root and preserves the wrapped array structure when writing the JSON files.
