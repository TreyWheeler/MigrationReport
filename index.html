<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Migration Report</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    :root {
      --md-font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      --md-color-surface: #ffffff;
      --md-color-surface-variant: #f5f5f7;
      --md-color-background: #f3f4f6;
      --md-color-on-surface: #111827;
      --md-color-outline: #e0e0e0;
      --md-color-primary: #2962ff;
      --glass-bg: rgba(255,255,255,0.7);
      --diff-bg: #fff3cd; /* soft amber */

      /* Score palette (Material-ish) */
      --score-red: #d32f2f;      /* Red 700 */
      --score-orange: #f57c00;   /* Orange 700 */
      --score-yellow: #ffc107;   /* Amber 500 */
      --score-green: #388e3c;    /* Green 700 */
      --score-muted: #87CEEB;    /* SkyBlue */
      --score-muted-text: #0b3954; /* Dark teal for contrast */
    }

    body[data-theme="dark"] {
      --md-color-surface: #0f172a;
      --md-color-surface-variant: #111827;
      --md-color-background: #0b1220;
      --md-color-on-surface: #e5e7eb;
      --md-color-outline: #1f2937;
      --md-color-primary: #82aaff;
      --glass-bg: rgba(17,24,39,0.6);
      --diff-bg: #3b2f0b; /* deep amber-brown tint */
      /* Score palette adjustments remain readable on dark */
      --score-orange: #ff9800;
      --score-yellow: #ffd54f;
      --score-green: #66bb6a;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--md-color-background);
      color: var(--md-color-on-surface);
      font-family: var(--md-font-family);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }
    body { display: flex; flex-direction: column; min-height: 100vh; }
    /* Let the body/page scroll naturally for sticky headers */

    h1 {
      font-size: 22px;
      margin: 16px 0 8px;
    }

    .container { max-width: 100%; margin: 0 auto; padding: 12px 24px 24px; }
    .controls { display: flex; flex-direction: column; gap: 8px; flex: 1 1 auto; min-height: 0; overflow: hidden; }
    .controls .toggle { align-self: flex-start; }
    .layout { display: grid; grid-template-columns: minmax(260px, 320px) minmax(0, 1fr); gap: 16px; align-items: stretch; width: 100%; flex: 1 1 auto; min-height: 0; }
    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
    .sidebar {
      position: sticky; top: 12px;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      height: calc(100vh - 24px);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .content { display: flex; flex-direction: column; min-height: 0; min-width: 0; }
    #report { }
    .empty-state {
      border: 2px dashed var(--md-color-outline);
      background: color-mix(in srgb, var(--md-color-surface) 92%, var(--md-color-background));
      border-radius: 16px;
      padding: 48px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      min-height: 320px;
      text-align: center;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.4), 0 12px 32px rgba(15,23,42,0.08);
    }
    .empty-state__icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: color-mix(in srgb, var(--md-color-primary) 12%, transparent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--md-color-primary);
    }
    .empty-state__icon svg { width: 42px; height: 42px; }
    .empty-state h2 { margin: 0; font-size: 20px; }
    .empty-state p { margin: 0; max-width: 420px; color: color-mix(in srgb, var(--md-color-on-surface) 88%, transparent); }
    .empty-state__hint { font-size: 13px; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    body[data-theme="dark"] .empty-state {
      background: color-mix(in srgb, var(--md-color-surface) 86%, transparent);
      border-color: color-mix(in srgb, var(--md-color-outline) 60%, transparent);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 12px 32px rgba(0,0,0,0.35);
    }
    body[data-theme="dark"] .empty-state__icon {
      background: color-mix(in srgb, var(--md-color-primary) 26%, transparent);
      color: color-mix(in srgb, var(--md-color-primary) 90%, #ffffff 10%);
    }
    .toolbar { display: flex; flex-wrap: wrap; gap: 8px 12px; align-items: center; margin: 8px 0; }
    .toggle {
      display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px;
      border: 1px solid var(--md-color-outline); border-radius: 9999px; background: var(--md-color-surface);
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      font-size: 12px; user-select: none; color: var(--md-color-on-surface);
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
    }
    .toggle:hover { border-color: var(--md-color-primary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent); }
    .toggle:has(input:checked) { background: color-mix(in srgb, var(--md-color-primary) 18%, var(--md-color-surface)); border-color: var(--md-color-primary); }
    .pill-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      font-size: 12px;
      color: var(--md-color-on-surface);
      cursor: pointer;
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
    }
    .pill-button:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .pill-button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }
    body[data-theme="dark"] .toggle {
      background: #111827; border-color: #334155; color: var(--md-color-on-surface);
      box-shadow: 0 1px 1px rgba(0,0,0,0.4);
    }
    body[data-theme="dark"] .toggle:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 24%, transparent);
    }
    body[data-theme="dark"] .toggle:has(input:checked) {
      background: color-mix(in srgb, var(--md-color-primary) 28%, #111827);
      border-color: var(--md-color-primary);
      color: #ffffff;
    }
    body[data-theme="dark"] .pill-button {
      background: #111827;
      border-color: #334155;
      color: var(--md-color-on-surface);
      box-shadow: 0 1px 1px rgba(0,0,0,0.4);
    }
    body[data-theme="dark"] .pill-button:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 24%, transparent);
    }
    body[data-theme="dark"] .pill-button:disabled {
      box-shadow: none;
    }
    .toggle input { accent-color: var(--md-color-primary); }
    .controls .pill-button { align-self: flex-start; }
    .flag-icon { width: 18px; height: 12px; border-radius: 2px; object-fit: cover; box-shadow: 0 0 0 1px rgba(0,0,0,0.06); }
    th.country-header .flag-icon { margin-right: 6px; vertical-align: -2px; }
    /* selection preview removed */
    /* Custom country list */
    .country-list { display: flex; flex-direction: column; gap: 6px; padding: 8px; border: 1px solid var(--md-color-outline); border-radius: 12px; background: var(--md-color-surface); flex: 1 1 auto; min-height: 0; overflow: auto; overscroll-behavior: contain; }
    .country-item { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border: 1px solid var(--md-color-outline); border-radius: 10px; background: var(--md-color-surface); cursor: pointer; user-select: none; }
    .country-item:hover { border-color: var(--md-color-primary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent); }
    .country-item.selected { background: color-mix(in srgb, var(--md-color-primary) 16%, var(--md-color-surface)); border-color: var(--md-color-primary); }
    .country-item .name { font-size: 13px; }
    .country-item .right-chip { margin-left: auto; }
    .country-group { display: flex; flex-direction: column; gap: 4px; }
    .country-item-root { padding-left: 2px; }
    .country-item .tree-toggle { border: none; background: transparent; color: inherit; width: 22px; height: 22px; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; }
    .country-item .tree-toggle:hover { background: color-mix(in srgb, var(--md-color-primary) 12%, transparent); }
    .country-item .tree-toggle:focus-visible { outline: 2px solid var(--md-color-primary); outline-offset: 2px; }
    .city-list { display: flex; flex-direction: column; gap: 4px; margin-left: 24px; }
    .city-list[hidden] { display: none !important; }
    .city-item { background: color-mix(in srgb, var(--md-color-surface) 92%, var(--md-color-background)); }
    .city-item .name { font-size: 12px; }
    body[data-theme="dark"] .country-list { background: #0f172a; border-color: #334155; }
    body[data-theme="dark"] .country-item { background: #111827; border-color: #334155; }
    body[data-theme="dark"] .country-item.selected { background: color-mix(in srgb, var(--md-color-primary) 24%, #111827); border-color: var(--md-color-primary); }
    body[data-theme="dark"] .city-item { background: color-mix(in srgb, #111827 92%, transparent); }
    .hero { background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 45%, #10b981 100%); color: #fff; padding: 14px 16px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
    .hero-full { border-radius: 0; padding: 18px 0; }
    .hero-full .hero-inner h1 { margin: 0; font-size: 24px; }
    #countrySelect {
      width: 100%;
      max-width: 520px;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 8px;
      padding: 6px 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      color: var(--md-color-on-surface);
    }
    /* Sort dropdown in sidebar */
    .sort-controls { display: flex; gap: 8px; align-items: center; margin: 4px 0; }
    #countrySort {
      width: 100%;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 8px;
      padding: 6px 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      color: var(--md-color-on-surface);
    }
    #countrySort:focus { outline: none; border-color: var(--md-color-primary); box-shadow: 0 0 0 3px rgba(41,98,255,0.15); }
    #countrySelect:focus {
      outline: none;
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px rgba(41,98,255,0.15);
    }
    /* Improve multi-select readability */
    #countrySelect option { background: var(--md-color-surface); color: var(--md-color-on-surface); }
    #countrySelect option:checked { background: color-mix(in srgb, var(--md-color-primary) 22%, transparent); color: var(--md-color-on-surface); }
    #countrySelect optgroup { color: var(--md-color-on-surface); }
    /* Dark mode-specific tweaks for the selector */
    body[data-theme="dark"] #countrySelect {
      border-color: #334155; /* slate-700 */
      box-shadow: 0 0 0 0 rgba(0,0,0,0.0);
    }
    body[data-theme="dark"] #countrySort { border-color: #334155; box-shadow: 0 0 0 0 rgba(0,0,0,0.0); }
    body[data-theme="dark"] #countrySelect:focus {
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 30%, transparent);
    }
    body[data-theme="dark"] #countrySort:focus { box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 30%, transparent); }
    body[data-theme="dark"] #countrySelect option { background: var(--md-color-surface); color: var(--md-color-on-surface); }
    body[data-theme="dark"] #countrySelect option:checked { background: color-mix(in srgb, var(--md-color-primary) 30%, transparent); color: var(--md-color-on-surface); }
    /* Remove default bullets for data lists */
    ul.score-list {
      list-style: none;
      padding-left: 0;
      margin-left: 0;
      margin-top: 8px;
      background: var(--glass-bg);
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      padding: 8px 8px;
    }

    /* Align dot and text nicely */
    li.score-item { display: flex; align-items: center; margin: 6px 0; color: var(--md-color-on-surface); }

    /* The colored score dot */
    .score-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      flex: 0 0 auto;
      background-color: #ccc; /* default fallback */
    }

    /* Comparison table styles */
    table.comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 14px;
      table-layout: fixed;
    }
    table.comparison-table th, table.comparison-table td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      vertical-align: top;
      transition: background-color 180ms ease, box-shadow 180ms ease;
      overflow-wrap: anywhere;
    }
    table.comparison-table th.country-header {
      background: #f7f7f7;
      text-align: left;
      white-space: nowrap;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .country-header-inner { display: flex; align-items: center; gap: 8px; }
    .country-header-label { display: inline-flex; align-items: center; gap: 6px; }
    .country-header-scores { display: flex; align-items: center; gap: 6px; margin-left: auto; flex-wrap: wrap; }
    .country-header-remove {
      display: none;
      margin-left: auto;
      width: 24px;
      height: 24px;
      border-radius: 9999px;
      border: 1px solid #b91c1c;
      background: rgba(220,38,38,0.12);
      color: #b91c1c;
      font-weight: 700;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 160ms ease;
    }
    .country-header-remove:hover {
      background: #dc2626;
      border-color: #dc2626;
      color: #ffffff;
      transform: scale(1.05);
    }
    .country-header-remove:focus-visible {
      outline: 2px solid #dc2626;
      outline-offset: 2px;
    }
    body[data-theme="dark"] .country-header-remove {
      border-color: #f87171;
      background: rgba(248,113,113,0.16);
      color: #fecaca;
    }
    body[data-theme="dark"] .country-header-remove:hover {
      background: #f87171;
      border-color: #f87171;
      color: #0b1220;
    }
    .country-header:hover .country-header-scores,
    .country-header-inner:hover .country-header-scores { display: none; }
    .country-header:hover .country-header-remove,
    .country-header-inner:hover .country-header-remove { display: inline-flex; }
    /* Header row appearance (not sticky; we handle stickiness via floating header) */
    table.comparison-table thead th {
      position: static;
      background: #f7f7f7;
    }
    body[data-theme="dark"] table.comparison-table thead th,
    body[data-theme="dark"] table.comparison-table th.country-header {
      background: #0f172a;
      color: var(--md-color-on-surface);
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    /* Sticky first column (header cell and body key cells) */
    table.comparison-table thead th:first-child {
      left: 0;
      z-index: 4;
    }
    tr.category-header-row th {
      background: #1f2937; /* slate-800 */
      color: #ffffff;
      font-weight: 800;
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-size: 14px;
      padding: 10px 8px;
    }
    /* Category collapse toggle */
    .cat-toggle {
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid rgba(255,255,255,0.25);
      background: transparent;
      color: inherit;
      border-radius: 6px;
      padding: 2px 6px;
      font-size: 12px;
      line-height: 1;
      margin-right: 8px;
      cursor: pointer;
    }
    .cat-toggle:hover { border-color: rgba(255,255,255,0.6); }
    td.key-cell {
      font-weight: 600;
      white-space: normal;
      position: sticky;
      left: 0;
      background: var(--md-color-surface);
      z-index: 2;
    }
    .key-cell .key-inner { display: flex; align-items: center; gap: 8px; }
    .key-cell .key-actions { margin-left: auto; display: inline-flex; align-items: center; gap: 6px; }
    .key-cell .info-toggle-btn {
      font-size: 12px;
      padding: 4px 8px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease, box-shadow 160ms ease, border-color 160ms ease, color 160ms ease;
    }
    .key-cell .info-toggle-btn.override-active {
      border-color: var(--md-color-primary);
      color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .key-cell:hover .info-toggle-btn { opacity: 1; pointer-events: auto; }
    .key-cell .compare-btn {
      font-size: 12px;
      padding: 4px 8px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
    }
    .key-cell:hover .compare-btn { opacity: 1; pointer-events: auto; }
    .key-cell .compare-btn:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    td.value-cell {
      width: auto;
    }
    /* Dig In button visibility on hover */
    .value-cell .dig-in-btn {
      margin-left: auto;
      font-size: 12px;
      padding: 4px 8px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
    }
    .value-cell:hover .dig-in-btn { opacity: 1; pointer-events: auto; }
    .value-cell .dig-in-btn:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .value-cell.diff-cell { background: var(--diff-bg) !important; }
    /* Zebra rows */
    .comparison-table tbody tr:nth-child(odd) td { background: var(--md-color-surface); }
    .comparison-table tbody tr:nth-child(even) td { background: var(--md-color-surface-variant); }
    .cell-inner {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    /* Scroll container for sticky positioning to work */
    .table-wrap {
      /* Fill available height in content column and provide scroll context for sticky thead */
      flex: 1 1 auto;
      min-height: 0;
      overflow: auto;
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      background: var(--glass-bg);
      backdrop-filter: saturate(140%) blur(8px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08);
    }

    /* Floating header overlay (replaces sticky thead for reliability) */
    .floating-header { position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #ddd; visibility: hidden; opacity: 0; pointer-events: none; transition: opacity 120ms ease; height:0px; }
    .floating-header.visible { visibility: visible; opacity: 1; pointer-events: auto; }
    .floating-row { display: grid; align-items: center; background: #f7f7f7; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
    .floating-row .fh-cell { padding: 6px 8px; border-right: 1px solid #ddd; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .floating-row .fh-cell:last-child { border-right: none; }
    body[data-theme="dark"] .floating-row { background: #0f172a; box-shadow: 0 2px 8px rgba(0,0,0,0.4); }
    .floating-row .fh-cell .flag-icon { margin-right: 6px; vertical-align: -2px; }
    #notice {
      color: #a33;
      margin-top: 6px;
      font-size: 12px;
    }
    /* Weights dialog */
    dialog#weightsDialog { border: none; border-radius: 12px; padding: 0; width: min(900px, 96vw); }
    dialog#weightsDialog::backdrop { background: rgba(0,0,0,0.35); }
    #weightsForm { background: var(--md-color-surface); color: var(--md-color-on-surface); border: 1px solid var(--md-color-outline); border-radius: 12px; overflow: hidden; }
    .wd-header { padding: 12px 16px; border-bottom: 1px solid var(--md-color-outline); background: var(--md-color-surface-variant); }
    .wd-body { max-height: min(65vh, 720px); overflow: auto; padding: 12px 16px; display: flex; flex-direction: column; gap: 16px; }
    .wd-footer { display: flex; justify-content: flex-end; gap: 8px; padding: 12px 16px; border-top: 1px solid var(--md-color-outline); background: var(--md-color-surface-variant); }
    .wd-section { border: 1px solid var(--md-color-outline); border-radius: 10px; padding: 10px; background: var(--md-color-surface); }
    .wd-section h4 { margin: 0 0 8px; }
    .wd-grid { display: grid; grid-template-columns: 1fr auto; gap: 10px 12px; align-items: center; }
    .wd-row { display: contents; }
    .wd-row label { font-weight: 600; }
    .wd-row .wd-slider { display: flex; align-items: center; gap: 8px; }
    .wd-row input[type="range"] { width: 280px; }
    .wd-row output { min-width: 42px; text-align: right; font-variant-numeric: tabular-nums; }
    .wd-footer .primary { background: var(--md-color-primary); color: white; border: none; padding: 6px 12px; border-radius: 8px; }
    .wd-footer button { border: 1px solid var(--md-color-outline); background: var(--md-color-surface); color: var(--md-color-on-surface); padding: 6px 12px; border-radius: 8px; }
    /* Score chips */
    .score-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 22px;
      padding: 0 8px;
      border-radius: 9999px;
      font-weight: 600;
      font-size: 12px;
      line-height: 1;
      letter-spacing: 0.02em;
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.08);
      transition: transform 160ms ease, box-shadow 160ms ease, background-color 160ms ease;
    }
    .score-chip.placeholder {
      visibility: hidden;
      pointer-events: none;
    }
    .score-chip:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.15), inset 0 -1px 0 rgba(0,0,0,0.08); }
    .bucket-red { background: var(--score-red); color: #fff; }
    .bucket-orange { background: var(--score-orange); color: #111; }
    .bucket-yellow { background: var(--score-yellow); color: #111; }
    .bucket-green { background: var(--score-green); color: #fff; }
    .bucket-muted { background: var(--score-muted); color: var(--score-muted-text); }
    /* Person chips: white background with black border */
    .person-chip { background: #ffffff; color: #000000; border: 1px solid #000000; box-shadow: none; }
    /* Hide score chips in the grid when toggled off */
    body.scores-hidden .comparison-table .score-chip,
    body.scores-hidden .comparison-table .person-chip,
    body.scores-hidden .floating-header .score-chip,
    body.scores-hidden .floating-header .person-chip { display: none !important; }
    /* Legend */
    .legend { display: flex; flex-wrap: wrap; gap: 8px 16px; align-items: center; margin: 8px 0 4px; font-size: 12px; color: var(--md-color-on-surface); }
    .legend-item { display: inline-flex; align-items: center; gap: 6px; }

    /* Density: compact mode */
    body.density-compact .comparison-table th,
    body.density-compact .comparison-table td { padding: 4px 6px; font-size: 13px; }
    body.density-compact .score-chip { min-width: 24px; height: 18px; padding: 0 6px; font-size: 11px; }

    /* Themed link styles */
    a { color: var(--md-color-primary); text-decoration: underline; text-underline-offset: 2px; }
    a:visited { color: var(--md-color-primary); }
    a:hover { color: color-mix(in srgb, var(--md-color-primary) 90%, #ffffff 10%); }
    a:focus-visible { outline: 2px solid color-mix(in srgb, var(--md-color-primary) 50%, transparent); outline-offset: 2px; border-radius: 2px; }
    /* Ensure links inside cells/lists inherit */
    .cell-inner a, ul.score-list a { color: var(--md-color-primary); }
    body[data-theme="dark"] a:hover { color: color-mix(in srgb, var(--md-color-primary) 80%, #ffffff 20%); }
    /* Header layout */
    .header-flex { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .header-controls { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
    #legendMount { display: flex; justify-content: flex-end; }
    .hero .legend { margin: 0; color: #fff; }
    /* Consistent header toggle styling (same in light and dark) */
    .hero .toolbar .toggle { background: #ffffff; border-color: #e5e7eb; color: #111; }
    .hero .toolbar .toggle:hover { border-color: var(--md-color-primary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 16%, transparent); }
    .hero .toolbar .toggle:has(input:checked) { background: color-mix(in srgb, var(--md-color-primary) 14%, #ffffff); border-color: var(--md-color-primary); color: #111; }
    .hero .toolbar .pill-button {
      background: #ffffff;
      border-color: #e5e7eb;
      color: #111827;
    }
    .hero .toolbar .pill-button:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 16%, transparent);
    }
  </style>
</head>
<body>
  <div class="hero hero-full">
    <div class="hero-inner container header-flex">
      <h1>Migration Report</h1>
      <div class="header-controls">
        <div class="toolbar">
          <label class="toggle"><input type="checkbox" id="diffToggle"/> Highlight differences</label>
          <label class="toggle"><input type="checkbox" id="densityToggle"/> Compact density</label>
          <label class="toggle"><input type="checkbox" id="themeToggle"/> Dark mode</label>
          <label class="toggle"><input type="checkbox" id="scoresToggle"/> Show scores</label>
          <button id="weightsBtn" type="button" class="toggle">Adjust weights</button>
          <button id="collapseCategoriesBtn" type="button" class="pill-button">Collapse all categories</button>
        </div>
        <div id="legendMount" class="legend"></div>
      </div>
    </div>
  </div>

  <div class="container layout">
    <aside class="sidebar">
      <div class="controls">
        <label>Select Locations (up to 3):</label>
        <div class="sort-controls">
          <label for="countrySort">Sort by:</label>
          <select id="countrySort">
            <option value="alpha">Alphabetical</option>
            <option value="alignment">Alignment</option>
            <option value="total">Total Score</option>
          </select>
        </div>
        <label class="toggle"><input type="checkbox" id="citiesOnlyToggle"/> Show only cities</label>
        <button id="collapseCountriesBtn" type="button" class="pill-button">Collapse all countries</button>
        <div id="countryList" class="country-list" role="listbox" aria-multiselectable="true"></div>
        <div id="notice"></div>
      </div>

    </aside>
    <main class="content">
      <div id="report"></div>
    </main>
  </div>
  <script src="script.js"></script>
  
  <!-- Weights Adjustment Dialog -->
  <dialog id="weightsDialog">
    <form id="weightsForm" method="dialog">
      <div class="wd-header">
        <h3 style="margin:0">Adjust Weights</h3>
      </div>
      <div id="weightsDialogBody" class="wd-body"></div>
      <div class="wd-footer">
        <button value="cancel" type="button" id="weightsCancel">Cancel</button>
        <button type="button" id="weightsReset">Reset to defaults</button>
        <button value="default" type="button" id="weightsSave" class="primary">Save</button>
      </div>
    </form>
  </dialog>
</body>
</html>
