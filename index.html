<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Migration Report</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    :root {
      --md-font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      --md-color-surface: #ffffff;
      --md-color-surface-variant: #f5f5f7;
      --md-color-background: #f3f4f6;
      --md-color-on-surface: #111827;
      --md-color-outline: #e0e0e0;
      --md-color-primary: #2962ff;
      --glass-bg: rgba(255,255,255,0.7);
      --diff-bg: #fff3cd; /* soft amber */
      --header-height: 20px;
      --sticky-header-offset: 0px;
      --footer-height: 72px;

      /* Score palette (Material-ish) */
      --score-red: #d32f2f;      /* Red 700 */
      --score-orange: #f57c00;   /* Orange 700 */
      --score-yellow: #ffc107;   /* Amber 500 */
      --score-green: #388e3c;    /* Green 700 */
      --score-muted: #87CEEB;    /* SkyBlue */
      --score-muted-text: #0b3954; /* Dark teal for contrast */
    }

    .app-loading {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      background: color-mix(in srgb, var(--md-color-background) 65%, rgba(0,0,0,0.55));
      color: var(--md-color-on-surface);
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
      transition: opacity 160ms ease, visibility 0s linear 160ms;
    }

    .app-loading--visible {
      opacity: 1;
      pointer-events: auto;
      visibility: visible;
      transition: opacity 160ms ease;
    }

    .app-loading__spinner {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 4px solid color-mix(in srgb, var(--md-color-on-surface) 20%, transparent);
      border-top-color: var(--md-color-primary);
      animation: app-loading-spin 1s linear infinite;
    }

    .app-loading__label {
      font-size: 16px;
      font-weight: 600;
      max-width: min(420px, 80vw);
      text-align: center;
    }

    .app-loading--error .app-loading__spinner {
      border-color: color-mix(in srgb, var(--score-red) 30%, transparent);
      border-top-color: var(--score-red);
    }

    .app-loading--hidden {
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
    }

    body[data-theme="dark"] .app-loading {
      background: color-mix(in srgb, rgba(15,23,42,0.92) 80%, transparent);
      color: var(--md-color-on-surface);
    }

    @media (prefers-reduced-motion: reduce) {
      .app-loading,
      .app-loading--visible {
        transition: none;
      }
      .app-loading__spinner { animation-duration: 2s; }
    }

    @keyframes app-loading-spin {
      to { transform: rotate(360deg); }
    }

    body[data-theme="dark"] {
      --md-color-surface: #0f172a;
      --md-color-surface-variant: #111827;
      --md-color-background: #0b1220;
      --md-color-on-surface: #e5e7eb;
      --md-color-outline: #1f2937;
      --md-color-primary: #82aaff;
      --glass-bg: rgba(17,24,39,0.6);
      --diff-bg: #3b2f0b; /* deep amber-brown tint */
      /* Score palette adjustments remain readable on dark */
      --score-orange: #ff9800;
      --score-yellow: #ffd54f;
      --score-green: #66bb6a;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      clip-path: inset(50%);
      border: 0;
      white-space: nowrap;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--md-color-background);
      color: var(--md-color-on-surface);
      font-family: var(--md-font-family);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding-bottom: var(--footer-height);
    }
    /* Let the body/page scroll naturally for sticky headers */

    h1 { font-size: 20px; margin: 0; }

    .container { max-width: 100%; margin: 0 auto; padding: 10px 20px 20px; }
    .controls { display: flex; flex-direction: column; gap: 8px; flex: 1 1 auto; min-height: 0; overflow: hidden; }
    .app-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: color-mix(in srgb, var(--md-color-surface) 80%, transparent);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--md-color-outline);
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
      padding: 1px 6px;
    }
    .app-header .container { padding: 1px 8px; }
    .app-header__inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2px;
      min-height: var(--header-height);
      padding: 0;
    }
    .app-header__brand { display: flex; align-items: center; gap: 6px; }
    .app-header__brand h1 { font-size: 15px; }
    .app-header__controls { display: flex; flex-wrap: wrap; align-items: center; gap: 6px; justify-content: flex-end; }
    .header-toolbar { display: flex; flex-wrap: wrap; gap: 5px 6px; align-items: center; }
    .tab-nav {
      display: inline-flex;
      align-items: center;
      gap: 1px;
      padding: 0 3px;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 999px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .tab-button {
      border: 1px solid transparent;
      background: transparent;
      padding: 2px 7px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 11px;
      line-height: 1.1;
      color: var(--md-color-on-surface);
      cursor: pointer;
      transition: background-color 160ms ease, border-color 160ms ease, color 160ms ease, box-shadow 160ms ease;
    }
    .tab-button.is-active {
      background: color-mix(in srgb, var(--md-color-primary) 16%, var(--md-color-surface));
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 10%, transparent);
      color: var(--md-color-on-surface);
    }
    .tab-button:not(.is-active):hover { background: color-mix(in srgb, var(--md-color-primary) 10%, transparent); }
    .view-shell { flex: 1 1 auto; display: flex; flex-direction: column; gap: 24px; }
    .view-pane { display: none; }
    .view-pane.is-active { display: block; }
    .view-pane[hidden] { display: none !important; }
    .container.data-view__inner { padding-top: 6px; }
    .data-view__inner { display: flex; flex-direction: column; gap: 12px; }
    .data-toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px 12px;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: sticky;
      top: calc(var(--header-height) + 2px);
      z-index: 980;
    }
    .funnel-placeholder { display: flex; flex-direction: column; gap: 12px; padding: 16px 0 32px; }
    .legend-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: color-mix(in srgb, var(--md-color-surface) 90%, transparent);
      border-top: 1px solid var(--md-color-outline);
      box-shadow: 0 -6px 20px rgba(0,0,0,0.08);
      z-index: 950;
    }
    .legend-footer__inner {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 12px;
      flex-wrap: wrap;
      padding: 10px 24px;
      text-align: right;
    }
    .legend-footer__label { font-weight: 700; color: color-mix(in srgb, var(--md-color-on-surface) 88%, transparent); margin-left: auto; }
    .controls .toggle { align-self: flex-start; }
    .layout { display: grid; grid-template-columns: minmax(260px, 320px) minmax(0, 1fr); gap: 16px; align-items: stretch; width: 100%; flex: 1 1 auto; min-height: 0; }
    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
    .sidebar {
      position: sticky; top: calc(var(--header-height) + 12px);
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      height: calc(100vh - var(--header-height) - var(--footer-height) - 24px);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .content { display: flex; flex-direction: column; min-height: 0; min-width: 0; }
    #report { }
    .empty-state {
      border: 2px dashed var(--md-color-outline);
      background: color-mix(in srgb, var(--md-color-surface) 92%, var(--md-color-background));
      border-radius: 16px;
      padding: 48px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      min-height: 320px;
      text-align: center;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.4), 0 12px 32px rgba(15,23,42,0.08);
    }
    .empty-state__icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: color-mix(in srgb, var(--md-color-primary) 12%, transparent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--md-color-primary);
    }
    .empty-state__icon svg { width: 42px; height: 42px; }
    .empty-state h2 { margin: 0; font-size: 20px; }
    .empty-state p { margin: 0; max-width: 420px; color: color-mix(in srgb, var(--md-color-on-surface) 88%, transparent); }
    .empty-state__hint { font-size: 13px; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    body[data-theme="dark"] .empty-state {
      background: color-mix(in srgb, var(--md-color-surface) 86%, transparent);
      border-color: color-mix(in srgb, var(--md-color-outline) 60%, transparent);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 12px 32px rgba(0,0,0,0.35);
    }
    body[data-theme="dark"] .empty-state__icon {
      background: color-mix(in srgb, var(--md-color-primary) 26%, transparent);
      color: color-mix(in srgb, var(--md-color-primary) 90%, #ffffff 10%);
    }
    .toolbar { display: flex; flex-wrap: wrap; gap: 8px 12px; align-items: center; margin: 8px 0; }
    .toggle {
      display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px;
      border: 1px solid var(--md-color-outline); border-radius: 9999px; background: var(--md-color-surface);
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      font-size: 12px; user-select: none; color: var(--md-color-on-surface);
      cursor: pointer;
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
    }
    .app-header .toggle { padding: 4px 7px; font-size: 11px; }
    .toggle:hover { border-color: var(--md-color-primary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent); }
    .toggle:has(input:checked) { background: color-mix(in srgb, var(--md-color-primary) 18%, var(--md-color-surface)); border-color: var(--md-color-primary); }
    .pill-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      font-size: 12px;
      color: var(--md-color-on-surface);
      cursor: pointer;
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
    }
    .pill-button:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .pill-button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }
    body:not(.show-hidden-keys) .hidden-key { display: none !important; }
    body.show-hidden-keys .score-list .hidden-key { background: color-mix(in srgb, var(--md-color-primary) 10%, transparent); border-radius: 10px; }
    body.show-hidden-keys .comparison-table tr.hidden-key td { background: color-mix(in srgb, var(--md-color-primary) 8%, transparent); }
    body.show-hidden-keys .comparison-table tr.hidden-key .cell-inner { background: transparent; }
    body.show-hidden-keys .hidden-key-inner { font-style: italic; opacity: 0.85; }
    body.show-hidden-keys .hidden-key .score-chip { opacity: 0.9; }
    body[data-theme="dark"] .app-header,
    body[data-theme="dark"] .legend-footer {
      background: color-mix(in srgb, #0f172a 88%, transparent);
      border-color: #1f2937;
      box-shadow: 0 10px 28px rgba(0,0,0,0.55);
    }
    body[data-theme="dark"] .tab-nav {
      background: #0f172a;
      border-color: #334155;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }
    body[data-theme="dark"] .tab-button.is-active {
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 22%, transparent);
    }
    body[data-theme="dark"] .data-toolbar { background: #0f172a; border-color: #334155; box-shadow: 0 2px 10px rgba(0,0,0,0.45); }
    body[data-theme="dark"] .legend-footer__label { color: color-mix(in srgb, var(--md-color-on-surface) 86%, transparent); }
    body[data-theme="dark"] .toggle {
      background: #111827; border-color: #334155; color: var(--md-color-on-surface);
      box-shadow: 0 1px 1px rgba(0,0,0,0.4);
    }
    body[data-theme="dark"] .toggle:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 24%, transparent);
    }
    body[data-theme="dark"] .toggle:has(input:checked) {
      background: color-mix(in srgb, var(--md-color-primary) 28%, #111827);
      border-color: var(--md-color-primary);
      color: #ffffff;
    }
    body[data-theme="dark"] .pill-button {
      background: #111827;
      border-color: #334155;
      color: var(--md-color-on-surface);
      box-shadow: 0 1px 1px rgba(0,0,0,0.4);
    }
    body[data-theme="dark"] .pill-button:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 24%, transparent);
    }
    body[data-theme="dark"] .pill-button:disabled {
      box-shadow: none;
    }
    body[data-theme="dark"] .key-actions-toggle {
      background: #111827;
      border-color: #334155;
      color: var(--md-color-on-surface);
    }
    body[data-theme="dark"] .key-actions-menu {
      background: #0f172a;
      border-color: #334155;
      box-shadow: 0 18px 32px rgba(15,23,42,0.55);
    }
    body[data-theme="dark"].show-hidden-keys .score-list .hidden-key { background: color-mix(in srgb, var(--md-color-primary) 22%, transparent); }
    body[data-theme="dark"].show-hidden-keys .comparison-table tr.hidden-key td { background: color-mix(in srgb, var(--md-color-primary) 18%, transparent); }
    .toggle input { accent-color: var(--md-color-primary); }
    .controls .pill-button { align-self: flex-start; }
    .flag-icon { width: 18px; height: 12px; border-radius: 2px; object-fit: cover; box-shadow: 0 0 0 1px rgba(0,0,0,0.06); }
    th.country-header .flag-icon { margin-right: 6px; vertical-align: -2px; }
    /* selection preview removed */
    /* Custom country list */
    .country-list { display: flex; flex-direction: column; gap: 6px; padding: 8px; border: 1px solid var(--md-color-outline); border-radius: 12px; background: var(--md-color-surface); flex: 1 1 auto; min-height: 0; overflow: auto; overscroll-behavior: contain; }
    .country-item { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border: 1px solid var(--md-color-outline); border-radius: 10px; background: var(--md-color-surface); cursor: pointer; user-select: none; }
    .country-item:hover { border-color: var(--md-color-primary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent); }
    .country-item.selected { background: color-mix(in srgb, var(--md-color-primary) 16%, var(--md-color-surface)); border-color: var(--md-color-primary); }
    .country-item .name { font-size: 13px; }
    .country-item .right-chip { margin-left: auto; }
    .country-group { display: flex; flex-direction: column; gap: 4px; }
    .country-item-root { padding-left: 2px; }
    .country-item .tree-toggle { border: none; background: transparent; color: inherit; width: 22px; height: 22px; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; }
    .country-item .tree-toggle:hover { background: color-mix(in srgb, var(--md-color-primary) 12%, transparent); }
    .country-item .tree-toggle:focus-visible { outline: 2px solid var(--md-color-primary); outline-offset: 2px; }
    .city-list { display: flex; flex-direction: column; gap: 4px; margin-left: 24px; }
    .city-list[hidden] { display: none !important; }
    .city-item { background: color-mix(in srgb, var(--md-color-surface) 92%, var(--md-color-background)); }
    .city-item .name { font-size: 12px; }
    body[data-theme="dark"] .country-list { background: #0f172a; border-color: #334155; }
    body[data-theme="dark"] .country-item { background: #111827; border-color: #334155; }
    body[data-theme="dark"] .country-item.selected { background: color-mix(in srgb, var(--md-color-primary) 24%, #111827); border-color: var(--md-color-primary); }
    body[data-theme="dark"] .city-item { background: color-mix(in srgb, #111827 92%, transparent); }
    .hero { background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 45%, #10b981 100%); color: #fff; padding: 14px 16px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); }
    .hero-full { border-radius: 0; padding: 18px 0; }
    .hero-full .hero-inner h1 { margin: 0; font-size: 24px; }
    #countrySelect {
      width: 100%;
      max-width: 520px;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 8px;
      padding: 6px 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      color: var(--md-color-on-surface);
    }
    /* Sort dropdown in sidebar */
    .sort-controls,
    .alert-filter-controls { display: flex; gap: 8px; align-items: center; margin: 4px 0; }
    #countrySort {
      width: 100%;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 8px;
      padding: 6px 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      color: var(--md-color-on-surface);
    }
    #alertFilter {
      width: 100%;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 8px;
      padding: 6px 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      color: var(--md-color-on-surface);
    }
    #countrySort:focus { outline: none; border-color: var(--md-color-primary); box-shadow: 0 0 0 3px rgba(41,98,255,0.15); }
    #alertFilter:focus { outline: none; border-color: var(--md-color-primary); box-shadow: 0 0 0 3px rgba(41,98,255,0.15); }
    #countrySelect:focus {
      outline: none;
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px rgba(41,98,255,0.15);
    }
    /* Improve multi-select readability */
    #countrySelect option { background: var(--md-color-surface); color: var(--md-color-on-surface); }
    #countrySelect option:checked { background: color-mix(in srgb, var(--md-color-primary) 22%, transparent); color: var(--md-color-on-surface); }
    #countrySelect optgroup { color: var(--md-color-on-surface); }
    /* Dark mode-specific tweaks for the selector */
    body[data-theme="dark"] #countrySelect {
      border-color: #334155; /* slate-700 */
      box-shadow: 0 0 0 0 rgba(0,0,0,0.0);
    }
    body[data-theme="dark"] #countrySort,
    body[data-theme="dark"] #alertFilter { border-color: #334155; box-shadow: 0 0 0 0 rgba(0,0,0,0.0); }
    body[data-theme="dark"] #countrySelect:focus {
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 30%, transparent);
    }
    body[data-theme="dark"] #countrySort:focus,
    body[data-theme="dark"] #alertFilter:focus { box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 30%, transparent); }
    body[data-theme="dark"] #countrySelect option { background: var(--md-color-surface); color: var(--md-color-on-surface); }
    body[data-theme="dark"] #countrySelect option:checked { background: color-mix(in srgb, var(--md-color-primary) 30%, transparent); color: var(--md-color-on-surface); }
    /* Funnel view */
    .funnel-view__inner { display: flex; flex-direction: column; gap: 16px; padding: 16px 0 32px; }
    .funnel-grid { display: flex; flex-direction: column; gap: 12px; }
    .funnel-grid__headers,
    .funnel-row { display: grid; grid-template-columns: minmax(320px, 1fr) minmax(260px, 1fr); gap: 12px; align-items: flex-start; }
    .funnel-grid__headers { font-weight: 700; color: var(--md-color-on-surface); padding: 0 4px; }
    .funnel-rows { display: flex; flex-direction: column; gap: 12px; }
    .funnel-cell { background: var(--md-color-surface); border: 1px solid var(--md-color-outline); border-radius: 12px; padding: 10px; min-height: 110px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .funnel-cell__muted { margin: 0; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    .funnel-cell__controls { display: flex; flex-direction: column; gap: 6px; align-items: center; justify-content: center; text-align: center; }
    .funnel-cell__controls--center { align-items: center; justify-content: center; }
    .funnel-filter-summary { display: flex; flex-direction: column; gap: 4px; align-items: center; }
    .funnel-filter-summary__rule { font-weight: 600; color: var(--md-color-on-surface); }
    .funnel-filter-actions { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: center; }
    .funnel-icon-button {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: 2px solid transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 800;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;
    }
    .funnel-icon-button:focus-visible { outline: none; box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 32%, transparent); }
    .funnel-icon-button--add { background: color-mix(in srgb, #16a34a 16%, var(--md-color-surface)); border-color: color-mix(in srgb, #16a34a 40%, transparent); color: #0f5132; }
    .funnel-icon-button--edit { background: color-mix(in srgb, var(--md-color-primary) 12%, var(--md-color-surface)); border-color: color-mix(in srgb, var(--md-color-primary) 40%, transparent); color: var(--md-color-on-surface); }
    .funnel-icon-button--remove { background: color-mix(in srgb, #dc2626 10%, var(--md-color-surface)); border-color: color-mix(in srgb, #dc2626 35%, transparent); color: #7f1d1d; }
    .funnel-icon-button:hover { transform: translateY(-1px); }
    .funnel-icon-button:active { transform: translateY(0); }
    .funnel-report-list { display: flex; flex-wrap: wrap; gap: 6px; flex: 1 1 auto; align-items: flex-start; }
    .funnel-report-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 8px; border: 1px solid var(--md-color-outline); border-radius: 9px; background: var(--glass-bg); box-shadow: 0 1px 1px rgba(0,0,0,0.04); min-height: 32px; cursor: pointer; transition: transform 140ms ease, box-shadow 160ms ease, border-color 160ms ease, background-color 160ms ease; }
    .funnel-report-pill:hover { transform: translateY(-1px) scale(1.02); box-shadow: 0 4px 10px rgba(0,0,0,0.08); border-color: color-mix(in srgb, var(--md-color-primary) 24%, var(--md-color-outline)); }
    .funnel-report-pill:focus-visible { outline: 3px solid color-mix(in srgb, var(--md-color-primary) 26%, transparent); outline-offset: 2px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
    .funnel-report-pill .right-chip { transform: scale(0.92); transform-origin: left center; }
    .funnel-report-pill .name-wrap { display: flex; flex-direction: column; gap: 1px; }
    .funnel-report-pill .name { font-weight: 600; color: var(--md-color-on-surface); font-size: 13px; }
    .funnel-report-pill .meta { font-size: 11px; color: color-mix(in srgb, var(--md-color-on-surface) 68%, transparent); }
    body.density-compact .funnel-report-pill .meta { display: none; }
    .funnel-empty { margin: 0; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    .funnel-actions-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .funnel-dialog { border: none; padding: 0; border-radius: 16px; box-shadow: 0 18px 48px rgba(15, 23, 42, 0.26); }
    .funnel-dialog::backdrop { background: color-mix(in srgb, #0f172a 38%, transparent); }
    .funnel-dialog form { display: flex; flex-direction: column; gap: 14px; min-width: 320px; padding: 18px 20px; background: linear-gradient(180deg, color-mix(in srgb, var(--glass-bg) 80%, transparent) 0%, var(--md-color-surface) 100%); border-radius: 16px; border: 1px solid color-mix(in srgb, var(--md-color-outline) 60%, transparent); }
    .funnel-dialog h3 { margin: 0; display: flex; align-items: center; gap: 8px; font-size: 20px; }
    .funnel-dialog h3::before { content: 'ðŸŽ¯'; font-size: 18px; }
    .funnel-dialog label { display: flex; flex-direction: column; gap: 6px; font-weight: 600; color: var(--md-color-on-surface); }
    .funnel-dialog p { margin: 0; color: color-mix(in srgb, var(--md-color-on-surface) 75%, transparent); }
    .funnel-dialog input,
    .funnel-dialog select { padding: 10px 12px; border: 1px solid color-mix(in srgb, var(--md-color-outline) 65%, transparent); border-radius: 10px; background: var(--md-color-surface); color: var(--md-color-on-surface); box-shadow: inset 0 1px 0 rgba(255,255,255,0.45); }
    .funnel-dialog select:focus-visible { outline: none; box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 32%, transparent); }
    .funnel-dialog .dialog-actions { display: flex; justify-content: flex-end; gap: 8px; padding-top: 4px; }
    body[data-theme="dark"] .funnel-cell { background: #0f172a; border-color: #334155; box-shadow: 0 1px 2px rgba(0,0,0,0.35); }
    body[data-theme="dark"] .funnel-report-pill { background: color-mix(in srgb, #111827 96%, transparent); border-color: #334155; box-shadow: 0 1px 1px rgba(0,0,0,0.4); }
    body[data-theme="dark"] .funnel-dialog form { background: linear-gradient(180deg, color-mix(in srgb, #0b1220 85%, transparent) 0%, #0f172a 100%); border-color: #334155; box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
    body[data-theme="dark"] .funnel-dialog input,
    body[data-theme="dark"] .funnel-dialog select { background: #0b1220; border-color: #334155; box-shadow: inset 0 1px 0 rgba(255,255,255,0.05); }
    /* Remove default bullets for data lists */
    ul.score-list {
      list-style: none;
      padding-left: 0;
      margin-left: 0;
      margin-top: 8px;
      background: var(--glass-bg);
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      padding: 8px 8px;
    }

    /* Align dot and text nicely */
    li.score-item { display: flex; align-items: center; margin: 6px 0; color: var(--md-color-on-surface); gap: 8px; }
    .score-item .score-text { flex: 1 1 auto; min-width: 0; }
    .score-item .key-guidance-btn {
      opacity: 0;
      pointer-events: none;
      margin-left: 4px;
    }
    .score-item:hover .key-guidance-btn,
    .score-item:focus-within .key-guidance-btn {
      opacity: 1;
      pointer-events: auto;
    }

    /* The colored score dot */
    .score-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      flex: 0 0 auto;
      background-color: #ccc; /* default fallback */
    }

    /* Comparison table styles */
    table.comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 14px;
      table-layout: fixed;
    }
    table.comparison-table th, table.comparison-table td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      vertical-align: top;
      transition: background-color 180ms ease, box-shadow 180ms ease;
      overflow-wrap: anywhere;
    }
    table.comparison-table th.country-header {
      background: #f7f7f7;
      text-align: left;
      white-space: nowrap;
      overflow-wrap: normal;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .country-header-inner { display: flex; align-items: center; gap: 8px; min-width: 0; }
    .country-header-label { display: inline-flex; align-items: center; gap: 6px; white-space: nowrap; }
    .country-header-scores {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-left: auto;
      flex-wrap: wrap;
      transition: opacity 160ms ease;
    }
    .country-header-remove {
      display: inline-flex;
      margin-left: 6px;
      width: 24px;
      height: 24px;
      border-radius: 9999px;
      border: 1px solid #b91c1c;
      background: rgba(220,38,38,0.12);
      color: #b91c1c;
      font-weight: 700;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 160ms ease, opacity 160ms ease;
    }
    .country-header-remove:hover {
      background: #dc2626;
      border-color: #dc2626;
      color: #ffffff;
      transform: scale(1.05);
    }
    .country-header-remove:focus-visible {
      outline: 2px solid #dc2626;
      outline-offset: 2px;
      opacity: 1;
      pointer-events: auto;
    }
    body[data-theme="dark"] .country-header-remove {
      border-color: #f87171;
      background: rgba(248,113,113,0.16);
      color: #fecaca;
    }
    body[data-theme="dark"] .country-header-remove:hover {
      background: #f87171;
      border-color: #f87171;
      color: #0b1220;
    }
    .country-header:hover .country-header-scores,
    .country-header-inner:hover .country-header-scores {
      opacity: 0;
      pointer-events: none;
    }
    .country-header:hover .country-header-remove,
    .country-header-inner:hover .country-header-remove {
      opacity: 1;
      pointer-events: auto;
    }
    table.comparison-table thead th {
      position: sticky;
      top: var(--sticky-header-offset);
      z-index: 5;
      background: #f7f7f7;
    }
    body[data-theme="dark"] table.comparison-table thead th,
    body[data-theme="dark"] table.comparison-table th.country-header {
      background: #0f172a;
      color: var(--md-color-on-surface);
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    /* Sticky first column (header cell and body key cells) */
    table.comparison-table thead th:first-child {
      left: 0;
      z-index: 6;
    }
    tr.category-header-row th {
      background: #1f2937; /* slate-800 */
      color: #ffffff;
      font-weight: 800;
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-size: 14px;
      padding: 10px 8px;
    }
    tr.category-header-row th:first-child {
      vertical-align: middle;
    }
    tr.category-header-row th:not(:first-child) {
      text-align: center;
      vertical-align: middle;
      padding-top: 12px;
      padding-bottom: 12px;
    }
    .category-header-inner {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
      width: 100%;
    }
    .category-score-wrap { display: flex; justify-content: center; }
    .category-score-inner {
      display: inline-flex;
      align-items: center;
      flex-wrap: nowrap;
      gap: 6px;
      justify-content: center;
    }
    tr.category-header-row th:first-child .cat-label {
      flex: 1;
      min-width: 0;
    }
    /* Category collapse toggle */
    .cat-toggle {
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid rgba(255,255,255,0.25);
      background: transparent;
      color: inherit;
      border-radius: 6px;
      padding: 2px 6px;
      font-size: 12px;
      line-height: 1;
      margin-right: 8px;
      cursor: pointer;
    }
    .cat-toggle:hover { border-color: rgba(255,255,255,0.6); }
    .cat-focus-btn {
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(15,23,42,0.35);
      color: inherit;
      border-radius: 999px;
      padding: 4px;
      width: 28px;
      height: 28px;
      min-width: 28px;
      min-height: 28px;
      margin-left: auto;
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, transform 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    tr.category-header-row:hover .cat-focus-btn,
    tr.category-header-row:focus-within .cat-focus-btn {
      opacity: 0.86;
      pointer-events: auto;
    }
    .cat-focus-btn:hover,
    .cat-focus-btn:focus-visible {
      opacity: 1;
      border-color: rgba(255,255,255,0.6);
      outline: none;
    }
    .cat-focus-btn.is-active,
    .cat-focus-btn[aria-pressed="true"] {
      background: rgba(255,255,255,0.28);
      color: #ffffff;
      opacity: 1;
      pointer-events: auto;
      transform: scale(1.02);
    }
    .cat-focus-btn svg {
      width: 16px;
      height: 16px;
      pointer-events: none;
    }
    .cat-focus-icon { display: block; }
    body[data-theme="light"] .cat-focus-btn {
      background: rgba(255,255,255,0.88);
      color: #1f2937;
      border-color: rgba(31,41,55,0.15);
    }
    body[data-theme="light"] .cat-focus-btn:hover,
    body[data-theme="light"] .cat-focus-btn:focus-visible {
      border-color: rgba(31,41,55,0.45);
    }
    body[data-theme="light"] .cat-focus-btn.is-active,
    body[data-theme="light"] .cat-focus-btn[aria-pressed="true"] {
      background: #1f2937;
      color: #ffffff;
      border-color: #1f2937;
    }
    body[data-theme="light"] .cat-focus-btn.is-active svg,
    body[data-theme="light"] .cat-focus-btn[aria-pressed="true"] svg {
      color: #ffffff;
    }
    table.comparison-table.focus-active tr.focus-dimmed {
      opacity: 0.4;
    }
    table.comparison-table.focus-active tr.focus-target {
      opacity: 1;
    }
    @keyframes key-focus-flash {
      0% {
        background-color: color-mix(in srgb, var(--md-color-primary) 18%, transparent);
        box-shadow: 0 0 0 0 color-mix(in srgb, var(--md-color-primary) 28%, transparent);
      }
      55% {
        background-color: color-mix(in srgb, var(--md-color-primary) 32%, transparent);
        box-shadow: 0 0 0 12px color-mix(in srgb, var(--md-color-primary) 16%, transparent);
      }
      100% {
        background-color: transparent;
        box-shadow: 0 0 0 0 transparent;
      }
    }
    tr.key-flash .key-cell,
    tr.key-flash .value-cell {
      background: color-mix(in srgb, var(--md-color-primary) 9%, var(--md-color-surface));
    }
    tr.key-flash .key-inner {
      border-radius: 10px;
      animation: key-focus-flash 1.4s ease;
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--md-color-primary) 42%, transparent);
    }
    td.key-cell {
      font-weight: 600;
      white-space: normal;
      position: sticky;
      left: 0;
      background: var(--md-color-surface);
      z-index: 2;
    }
    td.key-cell:focus-within,
    td.key-cell.key-actions-open {
      z-index: 8;
    }
    .key-cell .key-inner { display: flex; align-items: center; gap: 8px; }
    .key-cell .key-actions { margin-left: auto; position: relative; display: inline-flex; align-items: center; }
    .key-actions-toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      line-height: 1;
      padding: 4px 8px;
      border-radius: 9999px;
      border: 1px solid var(--md-color-outline);
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      cursor: pointer;
      transition: border-color 160ms ease, box-shadow 160ms ease, color 160ms ease, background-color 160ms ease;
      min-width: 32px;
    }
    .key-actions-toggle:hover {
      border-color: var(--md-color-primary);
      color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .key-actions-toggle:focus-visible {
      outline: 2px solid var(--md-color-primary);
      outline-offset: 2px;
    }
    .key-actions-toggle span[aria-hidden="true"] { font-size: 18px; line-height: 1; }
    .key-actions-menu {
      position: absolute;
      top: calc(100% + 6px);
      right: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 180px;
      padding: 8px;
      background: var(--md-color-surface);
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.18);
      z-index: 5;
    }
    .key-actions-menu[hidden] { display: none; }
    .key-actions-menu .key-guidance-btn,
    .key-actions-menu .info-toggle-btn,
    .key-actions-menu .compare-btn {
      display: flex;
      width: 100%;
      justify-content: flex-start;
      opacity: 1;
      pointer-events: auto;
    }
    .key-guidance-btn,
    .key-actions-menu .info-toggle-btn,
    .key-actions-menu .compare-btn {
      font-size: 12px;
      padding: 6px 10px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      cursor: pointer;
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
    }
    .key-guidance-btn:hover,
    .key-actions-menu .info-toggle-btn:hover,
    .key-actions-menu .compare-btn:hover {
      border-color: var(--md-color-primary);
      color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .key-guidance-btn:focus-visible,
    .key-actions-menu .info-toggle-btn:focus-visible,
    .key-actions-menu .compare-btn:focus-visible {
      outline: 2px solid var(--md-color-primary);
      outline-offset: 2px;
    }
    .key-actions-menu .info-toggle-btn.override-active {
      border-color: var(--md-color-primary);
      color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    td.value-cell {
      width: auto;
      position: relative;
    }
    .value-cell.inherited-value::after {
      content: '';
      position: absolute;
      top: 6px;
      right: 6px;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--md-color-primary) 70%, var(--md-color-surface) 30%);
      box-shadow: 0 0 0 1px color-mix(in srgb, var(--md-color-on-surface) 18%, transparent);
      opacity: 0.82;
      transform: scale(1);
      transition: opacity 160ms ease, transform 160ms ease;
    }
    body[data-theme="dark"] .value-cell.inherited-value::after {
      background: color-mix(in srgb, var(--md-color-primary) 65%, var(--md-color-background) 35%);
      box-shadow: 0 0 0 1px color-mix(in srgb, var(--md-color-on-surface) 24%, transparent);
    }
    .value-cell.inherited-value:hover::after {
      opacity: 1;
      transform: scale(1.15);
    }
    /* Dig In button visibility on hover */
    .value-cell .dig-in-btn {
      margin-left: auto;
      font-size: 12px;
      padding: 4px 8px;
      border: 1px solid var(--md-color-outline);
      border-radius: 9999px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      overflow-wrap: normal;
      word-break: keep-all;
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
    }
    .value-cell:hover .dig-in-btn { opacity: 1; pointer-events: auto; }
    .value-cell .dig-in-btn:hover {
      border-color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .value-cell.diff-cell { background: var(--diff-bg) !important; }
    /* Zebra rows */
    .comparison-table tbody tr:nth-child(odd) td { background: var(--md-color-surface); }
    .comparison-table tbody tr:nth-child(even) td { background: var(--md-color-surface-variant); }
    .cell-inner {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .alert-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      flex: 0 0 auto;
      border: 1px solid color-mix(in srgb, #f59e0b 60%, transparent);
      background: color-mix(in srgb, #facc15 80%, #fff 20%);
      color: #0f172a;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.25);
    }
    .alert-icon--incompatible {
      background: color-mix(in srgb, #fb7185 80%, #fff 20%);
      border-color: color-mix(in srgb, #dc2626 70%, transparent);
    }
    .alert-icon__glyph {
      width: 12px;
      height: 12px;
    }
    .alert-icon--cell { margin-left: 4px; }
    .alert-icon--header { margin-left: 6px; }
    .alert-icon--sidebar { margin-left: auto; }
    .alert-icon--category { margin-left: 0; }
    body[data-theme="dark"] .alert-icon {
      background: color-mix(in srgb, #facc15 70%, #111827 30%);
      border-color: color-mix(in srgb, #f59e0b 60%, #111827 40%);
      color: #0f172a;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.35);
    }
    body[data-theme="dark"] .alert-icon--incompatible {
      background: color-mix(in srgb, #fb7185 70%, #111827 30%);
      border-color: color-mix(in srgb, #dc2626 60%, #111827 40%);
    }
    /* Scroll container for sticky positioning to work */
    .table-wrap {
      /* Fill available height in content column and provide scroll context for sticky thead */
      flex: 1 1 auto;
      min-height: 0;
      overflow: auto;
      position: relative;
      border: 1px solid var(--md-color-outline);
      border-radius: 12px;
      background: var(--glass-bg);
      backdrop-filter: saturate(140%) blur(8px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08);
    }

    /* Floating header overlay (replaces sticky thead for reliability) */
    .floating-header { position: sticky; top: var(--sticky-header-offset); z-index: 10; border-bottom: 1px solid #ddd; visibility: hidden; opacity: 0; pointer-events: none; transition: opacity 120ms ease; height:0px; }
    .floating-header.visible { visibility: visible; opacity: 1; pointer-events: auto; }
    .floating-row { display: grid; align-items: center; background: #f7f7f7; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
    .floating-row .fh-cell { padding: 6px 8px; border-right: 1px solid #ddd; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .floating-row .fh-cell:last-child { border-right: none; }
    body[data-theme="dark"] .floating-row { background: #0f172a; box-shadow: 0 2px 8px rgba(0,0,0,0.4); }
    .floating-row .fh-cell .flag-icon { margin-right: 6px; vertical-align: -2px; }
    .floating-header-spacer { height: 0; flex: 0 0 auto; width: 100%; }
    #notice {
      color: #a33;
      margin-top: 6px;
      font-size: 12px;
    }
    /* Weights dialog */
    dialog#weightsDialog { border: none; border-radius: 12px; padding: 0; width: min(900px, 96vw); }
    dialog#keyGuidanceDialog {
      border: none;
      border-radius: 16px;
      padding: 0;
      width: min(640px, 92vw);
      max-width: 640px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      box-shadow: 0 24px 48px rgba(15,23,42,0.28);
    }
    dialog#keyGuidanceDialog::backdrop { background: rgba(0,0,0,0.35); }
    .kg-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      padding: 16px;
      border-bottom: 1px solid var(--md-color-outline);
      background: var(--md-color-surface-variant);
    }
    .kg-title-wrap { display: flex; flex-direction: column; gap: 4px; }
    .kg-title { margin: 0; font-size: 18px; }
    .kg-subtitle { margin: 0; font-size: 13px; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    .kg-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: min(70vh, 640px);
      overflow: auto;
    }
    .kg-section { display: flex; flex-direction: column; gap: 8px; }
    .kg-section h4 { margin: 0; font-size: 15px; }
    .kg-text { margin: 0; font-size: 14px; line-height: 1.5; }
    .kg-considerations { margin: 0; font-size: 13px; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    .kg-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .kg-table th, .kg-table td { border: 1px solid var(--md-color-outline); padding: 6px 8px; text-align: left; vertical-align: top; }
    .kg-table th { background: var(--md-color-surface-variant); }
    .kg-rating-cell { font-weight: 700; width: 72px; text-align: center; }
    .kg-empty { text-align: center; font-style: italic; color: color-mix(in srgb, var(--md-color-on-surface) 70%, transparent); }
    .kg-alerts { border-top: 1px solid var(--md-color-outline); padding-top: 12px; margin-top: 4px; }
    .kg-alert-row { display: flex; flex-direction: column; gap: 4px; }
    .kg-alert-row label { font-size: 13px; color: color-mix(in srgb, var(--md-color-on-surface) 80%, transparent); }
    .kg-alert-row select {
      border-radius: 8px;
      border: 1px solid var(--md-color-outline);
      padding: 6px 8px;
      font-size: 13px;
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
    }
    body[data-theme="dark"] .kg-alert-row select {
      background: #0f172a;
      border-color: #334155;
      color: #e2e8f0;
    }
    .kg-close {
      border: 1px solid var(--md-color-outline);
      background: var(--md-color-surface);
      color: var(--md-color-on-surface);
      border-radius: 9999px;
      padding: 4px 10px;
      font-size: 13px;
      cursor: pointer;
      transition: background-color 160ms ease, border-color 160ms ease, box-shadow 160ms ease, color 160ms ease;
    }
    .kg-close:hover {
      border-color: var(--md-color-primary);
      color: var(--md-color-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-color-primary) 12%, transparent);
    }
    .kg-close:focus-visible { outline: 2px solid var(--md-color-primary); outline-offset: 2px; }
    body[data-theme="dark"] dialog#keyGuidanceDialog {
      background: #0f172a;
      color: var(--md-color-on-surface);
      box-shadow: 0 24px 48px rgba(0,0,0,0.6);
    }
    body[data-theme="dark"] .kg-header {
      background: #111c2f;
      border-color: #1f2937;
    }
    body[data-theme="dark"] .kg-table th,
    body[data-theme="dark"] .kg-table td { border-color: #1f2937; }
    body[data-theme="dark"] .kg-table th { background: #111c2f; }
    body[data-theme="dark"] .kg-close {
      background: #111827;
      border-color: #334155;
    }
    dialog#weightsDialog::backdrop { background: rgba(0,0,0,0.35); }
    #weightsForm { background: var(--md-color-surface); color: var(--md-color-on-surface); border: 1px solid var(--md-color-outline); border-radius: 12px; overflow: hidden; }
    .wd-header { padding: 12px 16px; border-bottom: 1px solid var(--md-color-outline); background: var(--md-color-surface-variant); }
    .wd-body { max-height: min(65vh, 720px); overflow: auto; padding: 12px 16px; display: flex; flex-direction: column; gap: 16px; }
    .wd-footer { display: flex; justify-content: flex-end; gap: 8px; padding: 12px 16px; border-top: 1px solid var(--md-color-outline); background: var(--md-color-surface-variant); }
    .wd-section { border: 1px solid var(--md-color-outline); border-radius: 10px; padding: 10px; background: var(--md-color-surface); }
    .wd-section h4 { margin: 0 0 8px; }
    .wd-grid { display: grid; grid-template-columns: 1fr auto; gap: 10px 12px; align-items: center; }
    .wd-row { display: contents; }
    .wd-row label { font-weight: 600; }
    .wd-row .wd-slider { display: flex; align-items: center; gap: 8px; }
    .wd-row input[type="range"] { width: 280px; }
    .wd-row output { min-width: 42px; text-align: right; font-variant-numeric: tabular-nums; }
    .wd-footer .primary { background: var(--md-color-primary); color: white; border: none; padding: 6px 12px; border-radius: 8px; }
    .wd-footer button { border: 1px solid var(--md-color-outline); background: var(--md-color-surface); color: var(--md-color-on-surface); padding: 6px 12px; border-radius: 8px; cursor: pointer; }
    /* Score chips */
    .score-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 22px;
      padding: 0 8px;
      border-radius: 9999px;
      font-weight: 600;
      font-size: 12px;
      line-height: 1;
      letter-spacing: 0.02em;
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.08);
      transition: transform 160ms ease, box-shadow 160ms ease, background-color 160ms ease;
    }
    .score-chip.placeholder {
      visibility: hidden;
      pointer-events: none;
    }
    .score-chip:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.15), inset 0 -1px 0 rgba(0,0,0,0.08); }
    .bucket-red { background: var(--score-red); color: #fff; }
    .bucket-orange { background: var(--score-orange); color: #111; }
    .bucket-yellow { background: var(--score-yellow); color: #111; }
    .bucket-green { background: var(--score-green); color: #fff; }
    .bucket-muted { background: var(--score-muted); color: var(--score-muted-text); }
    .bucket-neutral { background: #ffffff; color: #111827; border: 1px solid rgba(15, 23, 42, 0.16); box-shadow: none; }
    body[data-theme="dark"] .bucket-neutral {
      background: #111827;
      color: #f8fafc;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: none;
    }
    /* Person chips: white background with black border */
    .person-chip { background: #ffffff; color: #000000; border: 1px solid #000000; box-shadow: none; }
    /* Hide score chips in the grid when toggled off */
    body.scores-hidden .comparison-table .score-chip,
    body.scores-hidden .comparison-table .person-chip,
    body.scores-hidden .floating-header .score-chip,
    body.scores-hidden .floating-header .person-chip { display: none !important; }
    /* Legend */
    .legend { display: flex; flex-wrap: wrap; gap: 8px 16px; align-items: center; margin: 0; font-size: 12px; color: var(--md-color-on-surface); }
    .legend-item { display: inline-flex; align-items: center; gap: 6px; }

    /* Density: compact mode */
    body.density-compact .comparison-table th,
    body.density-compact .comparison-table td { padding: 4px 6px; font-size: 13px; }
    body.density-compact .score-chip { min-width: 24px; height: 18px; padding: 0 6px; font-size: 11px; }

    /* Themed link styles */
    a { color: var(--md-color-primary); text-decoration: underline; text-underline-offset: 2px; }
    a:visited { color: var(--md-color-primary); }
    a:hover { color: color-mix(in srgb, var(--md-color-primary) 90%, #ffffff 10%); }
    a:focus-visible { outline: 2px solid color-mix(in srgb, var(--md-color-primary) 50%, transparent); outline-offset: 2px; border-radius: 2px; }
    /* Ensure links inside cells/lists inherit */
    .cell-inner a, ul.score-list a { color: var(--md-color-primary); }
    body[data-theme="dark"] a:hover { color: color-mix(in srgb, var(--md-color-primary) 80%, #ffffff 20%); }
    #legendMount { display: flex; flex: 0 0 auto; justify-content: flex-start; align-items: center; gap: 8px 16px; flex-wrap: wrap; min-width: 0; margin-left: 8px; }
  </style>
</head>
<body>
  <div id="appLoadingIndicator" class="app-loading app-loading--visible" role="status" aria-live="polite">
    <div class="app-loading__spinner" aria-hidden="true"></div>
    <div class="app-loading__label">Loading report dataâ€¦</div>
  </div>
  <header class="app-header">
    <div class="container app-header__inner">
      <div class="app-header__brand">
        <h1>Migration Report</h1>
      </div>
      <div class="app-header__controls">
        <nav class="tab-nav" aria-label="Primary views" role="tablist">
          <button type="button" id="dataTab" class="tab-button is-active" role="tab" aria-selected="true" aria-controls="dataView" data-view-tab="dataView">Data</button>
          <button type="button" id="funnelTab" class="tab-button" role="tab" aria-selected="false" aria-controls="funnelView" data-view-tab="funnelView">Funnel</button>
        </nav>
        <div class="toolbar header-toolbar">
          <label class="toggle"><input type="checkbox" id="densityToggle"/> Compact density</label>
          <label class="toggle"><input type="checkbox" id="themeToggle"/> Dark mode</label>
          <label class="toggle"><input type="checkbox" id="scoresToggle"/> Show scores</label>
        </div>
      </div>
    </div>
  </header>

  <main class="view-shell">
    <section id="dataView" class="view-pane is-active" role="tabpanel" aria-labelledby="dataTab" aria-label="Data view">
      <div class="container data-view__inner">
        <div class="toolbar data-toolbar">
          <label class="toggle"><input type="checkbox" id="diffToggle"/> Highlight differences</label>
          <button id="weightsBtn" type="button" class="toggle">Adjust weights</button>
          <button id="collapseCategoriesBtn" type="button" class="pill-button">Collapse all categories</button>
        </div>
        <div class="layout">
          <aside class="sidebar">
            <div class="controls">
              <label>Select Locations (up to 3):</label>
              <div class="sort-controls">
                <label for="countrySort">Sort by:</label>
                <select id="countrySort">
                  <option value="alpha">Alphabetical</option>
                  <option value="alignment">Alignment</option>
                  <option value="total">Total Score</option>
                </select>
              </div>
              <div class="alert-filter-controls">
                <label for="alertFilter">Exclude:</label>
                <select id="alertFilter">
                  <option value="all">Nothing</option>
                  <option value="hide-none">No alerts (None)</option>
                  <option value="hide-warnings">Warnings</option>
                  <option value="hide-incompatible">Incompatible</option>
                </select>
              </div>
              <label class="toggle"><input type="checkbox" id="citiesOnlyToggle"/> Show only cities</label>
              <button id="collapseCountriesBtn" type="button" class="pill-button">Collapse all countries</button>
              <div id="countryList" class="country-list" role="listbox" aria-multiselectable="true"></div>
              <div id="notice"></div>
            </div>

          </aside>
          <div class="content">
            <div id="report"></div>
          </div>
        </div>
      </div>
    </section>
    <section id="funnelView" class="view-pane" role="tabpanel" aria-labelledby="funnelTab" aria-label="Funnel view" hidden>
      <div class="container funnel-view__inner">
        <div class="funnel-grid">
          <div class="funnel-grid__headers" aria-hidden="true">
            <div>Excluded reports</div>
            <div>Included reports</div>
          </div>
          <div id="funnelRows" class="funnel-rows" aria-live="polite"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="legend-footer" aria-label="Scoring key">
    <div class="container legend-footer__inner">
      <div class="legend-footer__label">Scoring key</div>
      <div id="legendMount" class="legend"></div>
    </div>
  </footer>

  <script type="module" src="src/main.js"></script>
  
  <!-- Key Guidance Dialog -->
  <dialog id="keyGuidanceDialog" aria-labelledby="kgDialogTitle" aria-describedby="kgDialogBody">
    <div class="kg-header">
      <div class="kg-title-wrap">
        <h3 id="kgDialogTitle" class="kg-title">Key guidance</h3>
        <p class="kg-subtitle"></p>
      </div>
      <button type="button" class="kg-close" aria-label="Close guidance dialog">Close</button>
    </div>
    <div id="kgDialogBody" class="kg-body">
      <section class="kg-section">
        <h4>Key guidance</h4>
        <p id="kgKeyGuidanceText" class="kg-text">No key guidance available.</p>
      </section>
      <section class="kg-section">
        <h4>Rating guidance</h4>
        <p id="kgConsiderations" class="kg-considerations" hidden></p>
        <table class="kg-table">
          <thead>
            <tr>
              <th scope="col">Rating</th>
              <th scope="col">What it means</th>
            </tr>
          </thead>
          <tbody id="kgTableBody"></tbody>
        </table>
      </section>
      <section class="kg-section kg-alerts">
        <h4>Alert thresholds</h4>
        <div class="kg-alert-row">
          <label for="kgAlertConcerning">Concerning atâ€¦</label>
          <select id="kgAlertConcerning">
            <option value="none">None</option>
          </select>
        </div>
        <div class="kg-alert-row">
          <label for="kgAlertIncompatible">Incompatible atâ€¦</label>
          <select id="kgAlertIncompatible">
            <option value="none">None</option>
          </select>
        </div>
      </section>
    </div>
  </dialog>

  <dialog id="funnelFilterDialog" class="funnel-dialog" aria-labelledby="funnelDialogTitle" aria-describedby="funnelDialogDesc">
    <form id="funnelFilterForm" novalidate>
      <h3 id="funnelDialogTitle">Configure filter</h3>
      <p id="funnelDialogDesc" class="funnel-view__hint">Choose a key and minimum alignment value to exclude reports below that threshold.</p>
      <label>
        Category
        <select id="funnelCategorySelect"></select>
      </label>
      <label>
        Key
        <select id="funnelKeySelect" required></select>
      </label>
      <label>
        Minimum alignment (rating guidance)
        <select id="funnelMinSelect" name="minimum" required></select>
      </label>
      <div class="dialog-actions">
        <button type="button" class="pill-button" id="funnelCancelBtn">Cancel</button>
        <button type="submit" class="pill-button">Save filter</button>
      </div>
    </form>
  </dialog>

  <!-- Weights Adjustment Dialog -->
  <dialog id="weightsDialog">
    <form id="weightsForm" method="dialog">
      <div class="wd-header">
        <h3 style="margin:0">Adjust Weights</h3>
      </div>
      <div id="weightsDialogBody" class="wd-body"></div>
      <div class="wd-footer">
        <button value="cancel" type="button" id="weightsCancel">Cancel</button>
        <button type="button" id="weightsReset">Reset to defaults</button>
        <button value="default" type="button" id="weightsSave" class="primary">Save</button>
      </div>
    </form>
  </dialog>
</body>
</html>
